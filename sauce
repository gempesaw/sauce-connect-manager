: ${SAUCE_USER:?"Need to set SAUCE_USER:

    export SAUCE_USER=<your sauce username>"}
: ${SAUCE_KEY:?"Need to set SAUCE_API_KEY:

    export SAUCE_KEY=<your sauce api key>"}

if [ "$1" == "update" ]
then
    COMMAND=1
    killall java -u $LOGNAME
    sleep 10
    rm -rf $HOME/sauceConnect
    cd
    mkdir $HOME/sauceConnect
    cd $HOME/sauceConnect
    curl http://saucelabs.com/downloads/Sauce-Connect-latest.zip -o sauce-connect-latest.zip
    unzip sauce-connect-latest.zip
    rm sauce-connect-latest.zip
fi

if [ "$1" == "restart" ]
then
    COMMAND=1
    killall java -u $LOGNAME
    nohup /usr/bin/java -jar $HOME/sauceConnect/Sauce-Connect.jar --shared-tunnel $SAUCE_USER $SAUCE_KEY > $HOME/$SAUCE_USER &
fi

if [ "$1" == "status" ]
then
    COMMAND=1
    (echo "MAILTO=\"dgempesaw@sharecare.com\"

00 20 * * * rm $HOME/sauce_connect.log
00 20 * * * /usr/bin/killall java -u qa -v
01 20 * * * /usr/bin/java -jar $HOME/sauceConnect/Sauce-Connect.jar $SAUCE_USER $SAUCE_KEY > $HOME/$SAUCE_USER

") | crontab

    echo "Running Sauce Tunnels:"
    ps aux | grep Sauce

    echo "
Current Crontab:"
    (crontab -l) | cat
fi

if [ "$1" == "help" ] || [ "$1" == "--help" ] || [ "$1" == "-h" ] || [ "$COMMAND" != 1 ]
then
    echo "$HELP"
fi

HELP="Usage: ./sauce COMMAND
Control your sauce tunnel.

The commands you can use are:

   help         Show this help

   restart      Kill all java processes belonging to the user and
                nohup the sauce tunnel, stdout redirected to
                $HOME/$SAUCE_USER

   status       Reconstruct the crontab, view the running Sauce
                tunnels and the current crontab

   update       Download a new version of the Sauce Connect jar in
                ~/sauceConnect. You'll want to run ./sauce restart
                after this to start the tunnel again
"

